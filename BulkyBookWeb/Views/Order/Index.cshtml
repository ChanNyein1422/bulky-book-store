@{
    var result = User.Identity.IsAuthenticated.ToString();
    var _userid = 0;
       if (result == "True")
    {
        _userid = Convert.ToInt32(User.Claims.ToArray()[BulkyBookWeb.AuthServices.Auth.AuthDataIndex.Id].Value);
    }
}
<p class="h3 fw-bold">Order Cart Receipt</p>

<div id="OrderDetail"></div>

@section scripts{
    <script>
        var shoppingCart = [];

        $(function(){
            load_OrderDetails();
        });
    

        function load_OrderDetails(){
            var localDatas = localStorage.getItem("shoppingCart");
            var totalPrice = 0;
            shoppingCart = JSON.parse(localDatas);
           
            console.log(shoppingCart);
            var elements = "";
            if(shoppingCart != null){
                var cartLength = shoppingCart.length;
                elements += `<table class="table">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Book ID</th>
                    <th scope="col">Title</th>
                    <th scope="col">Price</th>
                </tr>
            </thead>
            <tbody>`;
                for(var i in shoppingCart){
                    elements += `<tr id="${shoppingCart[i].bookid}">
                                <th scope="row">${shoppingCart[i].bookid}</th>
                                <td>${shoppingCart[i].bookname}</td>
                                <td>${shoppingCart[i].price}</td>
                    </tr>`;
                    totalPrice += parseFloat(shoppingCart[i].price);
                }
                
                elements += `
                </tbody>
        </table>
        <div class="row">
        <div class="col-md-7">
               <a class="btn border border-dark text-dark" href="../Book/"> Back To Books </a>
                </div>
        <div class="col-12 col-md-5">
                  <div class="justify-content-center text-center my-3 border rounded border-secondary">
                  <p class="h4 fw-bold my-3">Order Receipt</p>
                <p>Total Price: ${totalPrice}</p>
                <p>Total Books: ${cartLength}</p>
                <div>
                <button class="btn btn-success my-3" onclick="make_order()">Order Now</button>
                </div>
                </div>
        </div>
      
                `;
               
            }else{
                elements += `<p class='h4 mt-5'>No Order Here Yet.</p>
                    <a class="btn border border-dark text-dark" href="../Book/"> Choose Your Books Here </a>
                `;
            }
            $("#OrderDetail").empty().append(elements);
        }

        function make_order(){
            var localDatas = localStorage.getItem("shoppingCart");
           
            shoppingCart = JSON.parse(localDatas);
            var cartLength = shoppingCart.length;

            if(cartLength>0){
                var objArr = [];
                for(var i in shoppingCart){
                   var obj = {
                       "BookId": shoppingCart[i].bookid,
                       "UserId": @_userid
                   }
                   objArr.push(obj);
                }

                $.ajax({
                    cache: false,
                    url: '@Url.Action("UpSertList","Order")',
                    type: "Post",
                    data: { orders: objArr },
                    beforeSend: function () {
                      
                    },
                    success: function (myData) {
                        if(myData != null){
                        alert("Order Added");
                        }
                    },
                    complete: function () {
                        localStorage.removeItem("shoppingCart");
                        window.location="../Book/Index";
                       
                    }
                });
           
            }
        }

       

    </script>
}